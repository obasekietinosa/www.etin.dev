---
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";
import Button from "../../components/Button.astro";
import { getRoles, formatRoleDate } from "../../domains/Roles";

export async function getStaticPaths() {
  const roles = await getRoles();
  return roles.map((role) => ({
    params: { slug: role.slug },
    props: { role },
  }));
}

const { role } = Astro.props;
---

<Layout title={`${role.title} at ${role.company}`}>
  <main>
    <section class="px-0 md:px-4">
      <header class="pt-8 mb-8">
        <Button variant="secondary" as="a" href="/experiences" class="mb-8 block w-fit">
          ← Back to experiences
        </Button>
        <div class="flex items-center gap-6 mb-6">
            <div class="w-20 h-20 bg-white p-2 rounded-full border-2 border-secondary flex items-center justify-center overflow-hidden">
                <img class="w-full h-full object-contain" src={role.companyIcon} alt={`${role.company} logo`} />
            </div>
            <div>
                <h1 class="text-4xl md:text-5xl font-bold text-primary">
                    {role.title}
                </h1>
                {role.subtitle && <h2 class="text-2xl font-light text-primary">{role.subtitle}</h2>}
                <div class="text-xl mt-2 font-mono">
                    {role.company} | {formatRoleDate(role.startDate)} — {role.endDate ? formatRoleDate(role.endDate) : "Present"}
                </div>
            </div>
        </div>
      </header>
      <Card>
        <div class="prose prose-lg dark:prose-invert max-w-none font-mono">
            <h3 class="font-pixelify">Description</h3>
            <p class="whitespace-pre-line">{role.description}</p>

            <h3 class="font-pixelify mt-8">Skills</h3>
            <div class="flex flex-wrap gap-2 not-prose">
                {role.skills.map((skill) => (
                    <span class="bg-secondary text-primary px-3 py-1 rounded-full text-sm font-bold border border-secondary shadow-sm">
                        {skill}
                    </span>
                ))}
            </div>
        </div>
      </Card>
    </section>
  </main>
</Layout>
